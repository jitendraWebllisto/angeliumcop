!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-indexed-db",["exports","@angular/core","@angular/common"],n):n((e=e||self)["ngx-indexed-db"]={},e.ng.core,e.ng.common)}(this,function(e,n,t){"use strict";var o=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;function r(e,n,t){return new Promise(function(r,c){var i,u=o.open(e,n);u.onsuccess=function(e){i=u.result,r(i)},u.onerror=function(e){c("IndexedDB error: "+u.error)},"function"==typeof t&&(u.onupgradeneeded=function(e){console.log("checkout"),t(e,i)})})}var c="readonly",i="readwrite";function u(e,n,t){e||t("You need to use the openDatabase function to create a database before you query it!"),function(e,n){return e.objectStoreNames.contains(n)}(e,n)||t("objectStore does not exists: "+n)}function s(e,n){var t=e.transaction(n.storeName,n.dbMode);return t.onerror=n.error,t.oncomplete=n.complete,t.onabort=n.abort,t}function f(e,n,t,o){return{storeName:n,dbMode:e,error:function(e){t(e)},complete:function(e){o()},abort:function(e){t(e)}}}var a=function(){function e(e){if(this.dbConfig=e,!e.name)throw new Error("NgxIndexedDB: Please, provide the dbName in the configuration");if(!e.version)throw new Error("NgxIndexedDB: Please, provide the db version in the configuration");var n,t,r,c,i;n=e.name,t=e.version,r=e.objectStoresMeta,c=e.migrationFactory,(i=o.open(n,t)).onupgradeneeded=function(e){var n=e.target.result;r.forEach(function(e){if(!n.objectStoreNames.contains(e.store)){var t=n.createObjectStore(e.store,e.storeConfig);e.storeSchema.forEach(function(e){t.createIndex(e.name,e.keypath,e.options)})}});var t=c&&c();t&&Object.keys(t).map(function(e){return parseInt(e,10)}).filter(function(n){return n>e.oldVersion}).sort(function(e,n){return e-n}).forEach(function(e){t[e](n,i.transaction)}),n.close()},i.onsuccess=function(e){e.target.result.close()}}return Object.defineProperty(e.prototype,"currentStore",{set:function(e){this._currentStore=e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,n){var t=this;return new Promise(function(o,c){r(t.dbConfig.name,t.dbConfig.version).then(function(r){s(r,f(i,t._currentStore,c,o)).objectStore(t._currentStore).add(e,n).onsuccess=function(e){n=e.target.result,o(n)}})})},e.prototype.getByKey=function(e){var n=this;return new Promise(function(t,o){r(n.dbConfig.name,n.dbConfig.version).then(function(r){var i=s(r,f(c,n._currentStore,o,t)).objectStore(n._currentStore).get(e);i.onsuccess=function(e){t(e.target.result)},i.onerror=function(e){o(e)}})})},e.prototype.getByID=function(e){var n=this;return new Promise(function(t,o){r(n.dbConfig.name,n.dbConfig.version).then(function(r){u(r,n._currentStore,o),s(r,f(c,n._currentStore,o,t)).objectStore(n._currentStore).get(+e).onsuccess=function(e){t(e.target.result)}})})},e.prototype.getAll=function(){var e=this;return new Promise(function(n,t){r(e.dbConfig.name,e.dbConfig.version).then(function(o){u(o,e._currentStore,t);var r=s(o,f(c,e._currentStore,t,n)).objectStore(e._currentStore).getAll();r.onerror=function(e){t(e)},r.onsuccess=function(e){var t=e.target.result;n(t)}})})},e.prototype.update=function(e,n){var t=this;return new Promise(function(o,c){r(t.dbConfig.name,t.dbConfig.version).then(function(r){u(r,t._currentStore,c);var a=s(r,f(i,t._currentStore,c,o)),d=a.objectStore(t._currentStore);a.oncomplete=function(e){o(e)},d.put(e,n)})})},e.prototype.deleteRecord=function(e){var n=this;return new Promise(function(t,o){r(n.dbConfig.name,n.dbConfig.version).then(function(r){u(r,n._currentStore,o),s(r,f(i,n._currentStore,o,t)).objectStore(n._currentStore).delete(e).onsuccess=function(e){t(e)}})})},e.prototype.clear=function(){var e=this;return new Promise(function(n,t){r(e.dbConfig.name,e.dbConfig.version).then(function(o){u(o,e._currentStore,t);var r=s(o,f(i,e._currentStore,t,n));r.objectStore(e._currentStore).clear(),r.oncomplete=function(e){n()}})})},e.prototype.delete=function(e){var n=this;return new Promise(function(t,o){r(n.dbConfig.name,n.dbConfig.version).then(function(r){u(r,n._currentStore,o),s(r,f(i,n._currentStore,o,t)).objectStore(n._currentStore).delete(e)})})},e.prototype.openCursor=function(e,n){var t=this;return new Promise(function(o,i){r(t.dbConfig.name,t.dbConfig.version).then(function(r){u(r,t._currentStore,i),s(r,f(c,t._currentStore,i,o)).objectStore(t._currentStore).openCursor(n).onsuccess=function(n){e(n),o()}})})},e.prototype.getByIndex=function(e,n){var t=this;return new Promise(function(o,i){r(t.dbConfig.name,t.dbConfig.version).then(function(r){u(r,t._currentStore,i),s(r,f(c,t._currentStore,i,o)).objectStore(t._currentStore).index(e).get(n).onsuccess=function(e){o(e.target.result)}})})},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:n.Inject,args:[d]}]}]},e}();var d=new n.InjectionToken(null),g=function(){function e(){}return e.forRoot=function(n){return{ngModule:e,providers:[a,{provide:d,useValue:n}]}},e.decorators=[{type:n.NgModule,args:[{declarations:[],imports:[t.CommonModule]}]}],e}();e.CONFIG_TOKEN=d,e.NgxIndexedDBModule=g,e.NgxIndexedDBService=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-indexed-db.umd.min.js.map